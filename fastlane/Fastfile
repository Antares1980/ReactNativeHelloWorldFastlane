fastlane_version '2.117.1'

before_all do
#  ensure_git_branch
#  ensure_git_status_clean
#  git_pull
end
ENV["FASTLANE_XCODE_PROJECT_NAME"] = "ios/ReactNativeHelloWorld.xcodeproj"
ENV["FASTLANE_XCODE_SCHEME"] = "ReactNativeHelloWorld"
ENV["FASTLANE_XCODE_APP_NAME"] = "ReactNativeHelloWorld"
#ENV["FASTLANE_APP_CENTER_TOKEN"]
platform :ios do
   # iOS Lanes
   lane :tests do
     run_tests(
      scheme: ENV["FASTLANE_XCODE_SCHEME"],
      project: ENV[FASTLANE_PROJECT_NAME])
   end
   lane :build_no_ipa do
     build_ios_app(
      project: ENV["FASTLANE_XCODE_PROJECT_NAME"],
      configuration: "Debug",
      scheme: ENV["FASTLANE_XCODE_SCHEME"],
      silent: true,
      clean: true,
      skip_package_ipa: true
#      sdk: "iOS 11.1"        # use SDK as the name or path of the base SDK when building the project.
    )
   end
   lane :build do
     increment_build_number(
        xcodeproj: ENV["FASTLANE_XCODE_PROJECT_NAME"] # (optional, you must specify the path to your main Xcode project if it is not in the project root directory)
      )
     build_ios_app(
      project: ENV["FASTLANE_XCODE_PROJECT_NAME"],
      configuration: "Release",
      scheme: ENV["FASTLANE_XCODE_SCHEME"],
      silent: true,
      clean: true,
      export_method: "development",
      output_directory: "Build", # Destination directory. Defaults to current directory.
      output_name: "ReactNativeHelloWorld.ipa" ,      # specify the name of the .ipa file to generate (including file extension)
      skip_profile_detection: true,
#      sdk: "iOS 11.1"        # use SDK as the name or path of the base SDK when building the project.
      export_options: {
        provisioningProfiles: {
          "org.reactjs.native.example.ReactNativeHelloWorld" => "globile-poc"
        }
      }
    )


   end
   lane :distribute do
     appcenter_upload(
       api_token: ENV["FASTLANE_APP_CENTER_TOKEN"],
       owner_name: "globile-devops",
       app_name: ENV["FASTLANE_XCODE_APP_NAME"],
       ipa: "Build/ReactNativeHelloWorld.ipa",
       group: "Globile DevOps"
    )
  end
end
